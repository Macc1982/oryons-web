<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oris • Criar conta</title>

  <!-- Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.css" />

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

  <style>
    :root{--brand:#3857ff;--bg:#0b1221;--card:#0f1830;--stroke:#1e2b55;--txt:#fff;--muted:#8aa0d6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Arial}
    .wrap{max-width:920px;margin:24px auto;padding:16px}
    #map{height:380px;border-radius:12px;overflow:hidden;border:1px solid var(--stroke)}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:16px;margin-top:16px}
    label{display:block;margin:12px 0 6px;color:#a9b6d9}
    input,button{width:100%;padding:12px;border-radius:10px;border:1px solid #2b3c70;background:#0b1221;color:#fff}
    button{cursor:pointer;border:1px solid var(--brand)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hint{color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Crie sua conta</h2>

  <div id="map"></div>

  <div class="card">
    <div id="geocoder"></div>
    <p class="hint">Busque sua cidade/bairro ou clique no mapa para escolher sua localização inicial.</p>

    <label>Seu nome</label>
    <input id="displayName" placeholder="Ex.: Marcos A. (MACC)"/>

    <label>Foto de perfil (quadrada de preferência)</label>
    <input id="avatarFile" type="file" accept="image/*"/>

    <div class="row">
      <div>
        <label>Latitude</label>
        <input id="lat" readonly>
      </div>
      <div>
        <label>Longitude</label>
        <input id="lng" readonly>
      </div>
    </div>

    <button id="createBtn">Criar conta</button>
    <p id="status" class="hint"></p>
  </div>
</div>

<script>
  // ====== COLOQUE SUAS CHAVES AQUI ======
  const MAPBOX_TOKEN   = '<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oris • Criar conta</title>

  <!-- Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.css" />

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

  <style>
    :root{--brand:#3857ff;--bg:#0b1221;--card:#0f1830;--stroke:#1e2b55;--txt:#fff;--muted:#8aa0d6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Arial}
    .wrap{max-width:920px;margin:24px auto;padding:16px}
    #map{height:380px;border-radius:12px;overflow:hidden;border:1px solid var(--stroke)}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:16px;margin-top:16px}
    label{display:block;margin:12px 0 6px;color:#a9b6d9}
    input,button{width:100%;padding:12px;border-radius:10px;border:1px solid #2b3c70;background:#0b1221;color:#fff}
    button{cursor:pointer;border:1px solid var(--brand)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hint{color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Crie sua conta</h2>

  <div id="map"></div>

  <div class="card">
    <div id="geocoder"></div>
    <p class="hint">Busque sua cidade/bairro ou clique no mapa para escolher sua localização inicial.</p>

    <label>Seu nome</label>
    <input id="displayName" placeholder="Ex.: Marcos A. (MACC)"/>

    <label>Foto de perfil (quadrada de preferência)</label>
    <input id="avatarFile" type="file" accept="image/*"/>

    <div class="row">
      <div>
        <label>Latitude</label>
        <input id="lat" readonly>
      </div>
      <div>
        <label>Longitude</label>
        <input id="lng" readonly>
      </div>
    </div>

    <button id="createBtn">Criar conta</button>
    <p id="status" class="hint"></p>
  </div>
</div>

<script>
  // ====== COLOQUE SUAS CHAVES AQUI ======
  const MAPBOX_TOKEN   = '<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oris • Criar conta</title>

  <!-- Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.css" />

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

  <style>
    :root{--brand:#3857ff;--bg:#0b1221;--card:#0f1830;--stroke:#1e2b55;--txt:#fff;--muted:#8aa0d6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Arial}
    .wrap{max-width:920px;margin:24px auto;padding:16px}
    #map{height:380px;border-radius:12px;overflow:hidden;border:1px solid var(--stroke)}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:16px;margin-top:16px}
    label{display:block;margin:12px 0 6px;color:#a9b6d9}
    input,button{width:100%;padding:12px;border-radius:10px;border:1px solid #2b3c70;background:#0b1221;color:#fff}
    button{cursor:pointer;border:1px solid var(--brand)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hint{color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Crie sua conta</h2>

  <div id="map"></div>

  <div class="card">
    <div id="geocoder"></div>
    <p class="hint">Busque sua cidade/bairro ou clique no mapa para escolher sua localização inicial.</p>

    <label>Seu nome</label>
    <input id="displayName" placeholder="Ex.: Marcos A. (MACC)"/>

    <label>Foto de perfil (quadrada de preferência)</label>
    <input id="avatarFile" type="file" accept="image/*"/>

    <div class="row">
      <div>
        <label>Latitude</label>
        <input id="lat" readonly>
      </div>
      <div>
        <label>Longitude</label>
        <input id="lng" readonly>
      </div>
    </div>

    <button id="createBtn">Criar conta</button>
    <p id="status" class="hint"></p>
  </div>
</div>

<script>
  // ====== COLOQUE SUAS CHAVES AQUI ======
  const MAPBOX_TOKEN   = 'INSIRA_SEU_MAPBOX_TOKEN_AQUI';
  const SUPABASE_URL   = 'https://SEU-PROJ.supabase.co';
  const SUPABASE_ANON  = 'SEU_ANON_KEY_AQUI';

  // ====== MAPA ======
  mapboxgl.accessToken = MAPBOX_TOKEN;
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v11',
    center: [-38.501, -12.971], // Salvador (padrão)
    zoom: 9
  });

  const geocoder = new MapboxGeocoder({ accessToken: MAPBOX_TOKEN, mapboxgl });
  document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

  let pickMarker = null;
  function setPoint(lngLat){
    lat.value = lngLat.lat.toFixed(6);
    lng.value = lngLat.lng.toFixed(6);
    if(!pickMarker){
      pickMarker = new mapboxgl.Marker({color:'#3857ff'}).setLngLat(lngLat).addTo(map);
    } else {
      pickMarker.setLngLat(lngLat);
    }
  }

  const lat = document.getElementById('lat');
  const lng = document.getElementById('lng');
  map.on('click', (e)=> setPoint(e.lngLat));
  geocoder.on('result', (e)=>{
    const [lngV,latV] = e.result.center;
    setPoint({lng: lngV, lat: latV});
    map.flyTo({center:[lngV,latV], zoom: 12});
  });

  // ====== SUPABASE ======
  const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON);

  async function uploadAvatar(file){
    const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
    const path = avatar_${Date.now()}.${ext};
    const { error } = await supabase.storage.from('avatars').upload(path, file, { cacheControl: '3600', upsert: false });
    if(error) throw error;
    const { data } = supabase.storage.from('avatars').getPublicUrl(path);
    return data.publicUrl;
  }

  document.getElementById('createBtn').addEventListener('click', async ()=>{
    const status = document.getElementById('status');
    status.textContent = 'Enviando...';

    const name = document.getElementById('displayName').value.trim();
    const latV = parseFloat(lat.value);
    const lngV = parseFloat(lng.value);
    const file = document.getElementById('avatarFile').files[0];

    if(!name || isNaN(latV) || isNaN(lngV) || !file){
      status.textContent = 'Preencha o nome, escolha o ponto no mapa e selecione a foto.';
      return;
    }

    try{
      const avatarUrl = await uploadAvatar(file);
      const { data, error } = await supabase.from('profiles')
        .insert({ display_name: name, avatar_url: avatarUrl, lat: latV, lng: lngV })
        .select().single();
      if(error) throw error;

      localStorage.setItem('oris_profile_id', data.id);
      status.textContent = 'Conta criada! Indo para o mapa...';
      setTimeout(()=> window.location.href = 'map.html', 700);
    }catch(err){
      console.error(err);
      status.textContent = 'Erro ao criar conta.';
    }
  });
</script>
</body>
</html>';
  const SUPABASE_URL   = 'https://SEU-PROJ.supabase.co';
  const SUPABASE_ANON  = 'SEU_ANON_KEY_AQUI';

  // ====== MAPA ======
  mapboxgl.accessToken = MAPBOX_TOKEN;
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v11',
    center: [-38.501, -12.971], // Salvador (padrão)
    zoom: 9
  });

  const geocoder = new MapboxGeocoder({ accessToken: MAPBOX_TOKEN, mapboxgl });
  document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

  let pickMarker = null;
  function setPoint(lngLat){
    lat.value = lngLat.lat.toFixed(6);
    lng.value = lngLat.lng.toFixed(6);
    if(!pickMarker){
      pickMarker = new mapboxgl.Marker({color:'#3857ff'}).setLngLat(lngLat).addTo(map);
    } else {
      pickMarker.setLngLat(lngLat);
    }
  }

  const lat = document.getElementById('lat');
  const lng = document.getElementById('lng');
  map.on('click', (e)=> setPoint(e.lngLat));
  geocoder.on('result', (e)=>{
    const [lngV,latV] = e.result.center;
    setPoint({lng: lngV, lat: latV});
    map.flyTo({center:[lngV,latV], zoom: 12});
  });

  // ====== SUPABASE ======
  const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON);

  async function uploadAvatar(file){
    const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
    const path = avatar_${Date.now()}.${ext};
    const { error } = await supabase.storage.from('avatars').upload(path, file, { cacheControl: '3600', upsert: false });
    if(error) throw error;
    const { data } = supabase.storage.from('avatars').getPublicUrl(path);
    return data.publicUrl;
  }

  document.getElementById('createBtn').addEventListener('click', async ()=>{
    const status = document.getElementById('status');
    status.textContent = 'Enviando...';

    const name = document.getElementById('displayName').value.trim();
    const latV = parseFloat(lat.value);
    const lngV = parseFloat(lng.value);
    const file = document.getElementById('avatarFile').files[0];

    if(!name || isNaN(latV) || isNaN(lngV) || !file){
      status.textContent = 'Preencha o nome, escolha o ponto no mapa e selecione a foto.';
      return;
    }

    try{
      const avatarUrl = await uploadAvatar(file);
      const { data, error } = await supabase.from('profiles')
        .insert({ display_name: name, avatar_url: avatarUrl, lat: latV, lng: lngV })
        .select().single();
      if(error) throw error;

      localStorage.setItem('oris_profile_id', data.id);
      status.textContent = 'Conta criada! Indo para o mapa...';
      setTimeout(()=> window.location.href = 'map.html', 700);
    }catch(err){
      console.error(err);
      status.textContent = 'Erro ao criar conta.';
    }
  });
</script>
</body>
</html>';
  const SUPABASE_URL   = 'https://SEU-PROJ.supabase.co';
  const SUPABASE_ANON  = 'SEU_ANON_KEY_AQUI';

  // ====== MAPA ======
  mapboxgl.accessToken = MAPBOX_TOKEN;
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v11',
    center: [-38.501, -12.971], // Salvador (padrão)
    zoom: 9
  });

  const geocoder = new MapboxGeocoder({ accessToken: MAPBOX_TOKEN, mapboxgl });
  document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

  let pickMarker = null;
  function setPoint(lngLat){
    lat.value = lngLat.lat.toFixed(6);
    lng.value = lngLat.lng.toFixed(6);
    if(!pickMarker){
      pickMarker = new mapboxgl.Marker({color:'#3857ff'}).setLngLat(lngLat).addTo(map);
    } else {
      pickMarker.setLngLat(lngLat);
    }
  }

  const lat = document.getElementById('lat');
  const lng = document.getElementById('lng');
  map.on('click', (e)=> setPoint(e.lngLat));
  geocoder.on('result', (e)=>{
    const [lngV,latV] = e.result.center;
    setPoint({lng: lngV, lat: latV});
    map.flyTo({center:[lngV,latV], zoom: 12});
  });

  // ====== SUPABASE ======
  const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON);

  async function uploadAvatar(file){
    const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
    const path = avatar_${Date.now()}.${ext};
    const { error } = await supabase.storage.from('avatars').upload(path, file, { cacheControl: '3600', upsert: false });
    if(error) throw error;
    const { data } = supabase.storage.from('avatars').getPublicUrl(path);
    return data.publicUrl;
  }

  document.getElementById('createBtn').addEventListener('click', async ()=>{
    const status = document.getElementById('status');
    status.textContent = 'Enviando...';

    const name = document.getElementById('displayName').value.trim();
    const latV = parseFloat(lat.value);
    const lngV = parseFloat(lng.value);
    const file = document.getElementById('avatarFile').files[0];

    if(!name || isNaN(latV) || isNaN(lngV) || !file){
      status.textContent = 'Preencha o nome, escolha o ponto no mapa e selecione a foto.';
      return;
    }

    try{
      const avatarUrl = await uploadAvatar(file);
      const { data, error } = await supabase.from('profiles')
        .insert({ display_name: name, avatar_url: avatarUrl, lat: latV, lng: lngV })
        .select().single();
      if(error) throw error;

      localStorage.setItem('oris_profile_id', data.id);
      status.textContent = 'Conta criada! Indo para o mapa...';
      setTimeout(()=> window.location.href = 'map.html', 700);
    }catch(err){
      console.error(err);
      status.textContent = 'Erro ao criar conta.';
    }
  });
</script>
</body>
</html>
     
 
